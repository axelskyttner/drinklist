<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <script src="/jespers_react.js"></script>
    <link rel="stylesheet" href="/bootstrap">

    <title>Hello, world!</title>
  </head>
  <body>

<body style="background-image:url('http://reumatiskt.se/img/left_foot2.jpg')">

<h2>Vilkommen</h2>

</body>

<div class="row">
<div class="col"></div>
<h2>Hello strecklista</h2>
<div class="col"></div>
</div>

<form action="update_list" >
<div class = "row">
<div class="col"></div>
<div class="col btn-group btn-group-toggle" data-toggle="buttons">
  <label class="btn btn-secondary" style="margin:auto">
    <input type="radio" name="beverage"  autocomplete="off" > Beer
  </label>
  <label class="btn btn-secondary"  style="margin:auto">
    <input type="radio" name="beverage"  autocomplete="off"> Cider
  </label>
  <label class="btn btn-secondary"  style="margin:auto">
    <input type="radio" name="beverage"  autocomplete="off"> Snaps
  </label>
</div>

<div class="col"></div>
</div>

<div class-"row">
<div class="col"> </div>
<div class="col">
<ul class="list-group" id="list_of_active_users" style="width:100%">
</div>
<div class="col"></div>
</ul>
</div>
<div class="row">
<div class="col"></div>
  <input class="col-sm-3 btn btn-primary" type="submit" value="Submit">
<div class="col"></div>
</div>
</form>

<img src="https://media0.giphy.com/media/6qMZkhS6h0rKw/giphy.gif" alt="Mountain View" style="width:200px;height:200px;">
<img src="https://media0.giphy.com/media/nhC4BFdo98b7i/giphy.gif" alt="Mountain View" style="width:200px;height:200px;">


<h4 >All Users</h4>
<ul class="list-group" id="thelist">

</ul>
<script>
var frontEndCallback =(users_json)=>{
    var users = JSON.parse(users_json).users
    getAllUsers(users)
    getActiveUsers() 
    console.log("users",users)
}

function getAllUsers(users){
    var list = document.getElementById("thelist")
    var user_elements = users.map(create_listis)
    user_elements.forEach((el)=>{
        el.addEventListener("click", (e)=>{
           set_cookie("active", el.innerHTML) 
           location.reload()
        })
    })
    user_elements.forEach(li=>list.appendChild(li))

}

function getActiveUsers(){
    var activeUser1 = getCookie("active")
    var activeUsers = [activeUser1]
            .filter(name=> name !== "")
    activeUsers.forEach(createRadioButton)

}

function createRadioButton(user){
    var input = document.createElement("input")
    var li = document.createElement("li")
    var active_user_list = document.getElementById("list_of_active_users")
    input.setAttribute("type", "radio") 
    input.setAttribute("value", user) 
    input.setAttribute("name", "username") 
    li.setAttribute("class", "list-group-item") 
        active_user_list.appendChild(li)
    li.appendChild(input)
    li.innerHTML += user
}

function set_cookie(name, value){
    document.cookie = name + "=" + value;
}

function getCookie(cname) {
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}

//window.onload = ()=>{
    httpGetAsync("http://localhost:3000/get_users", frontEndCallback)
//}
</script>
  </body>
</html>
