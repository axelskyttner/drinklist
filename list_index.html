<!doctype html> <html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="http://molnhatt.se/bootstrap">

    <title>Drinking List!</title>
  </head>
  <body>
    <script src="http://molnhatt.se/jespers_react.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
 <div class="row">
<div class="col"></div>
<div class="col">
<h2> HÃ¤r se!   </h2>
</div>
<div class="col"></div>
</div>
<ul class="list-group" id="thelist"></ul>
<div id="advanced_user_data_container"></div>
    <script>
     
    const callback = (json_data)=>{
       const transaction_history = JSON.parse(json_data).history 
       const users = Array.from(new Set(transaction_history.map(a=>a.name)))
       console.log("users", users)

       var userData = users.map((username)=>{
            const transactions = transaction_history
                .filter(data=>data.name == username)
            const lastTime = transactions.slice(-1)[0].time
            console.log(lastTime)
            const times = transactions.map(trans=>parseTime(trans.time))
            console.log("times",times)
            const avarageDiff = calculateMeanDifference(times)
            const standardDeviation = calculateStandardDeviation(times)
            const  beer_transactions=  transactions.filter(a=>a.beverage === "beer")
            const  cider_transactions= transactions.filter(a=>a.beverage === "cider")
            const  snaps_transactions= transactions.filter(a=>a.beverage === "snaps")
        
            return {
                units: transactions.length,
                beers: beer_transactions.length,
                cider: cider_transactions.length,
                snaps: snaps_transactions.length,
                time:lastTime, 
                username:username, 
                standardDeviation:standardDeviation, 
                avarageDiff: avarageDiff} 
        })
        console.log("all userdata")
        userData.forEach(console.log)
        const elementList = userData.map(user=>
                createUserHtmlElement(user)
            )
        var list = document.getElementById("thelist")
            elementList.forEach(el=>list.appendChild(el))
        
        let advancedDataContainer = document.getElementById("advanced_user_data_container")
        const advancedHeader = createHeaderForAdvancedUserData("Axel")   
        var advancedUserData;
        if(userData.length > 0){
            let firstUser = userData[0] 
            console.log("firstUser", firstUser)
            advancedUserData = createAdvancedUserData(firstUser.beers + 1,firstUser.cider + 1,firstUser.snaps + 1);
        }
        else{

            advancedUserData = createAdvancedUserData(1,1,1);
        }
        var gaugePlot = createGaugePlot();
        advanced_user_data_container.appendChild(advancedHeader)
        advanced_user_data_container.appendChild(advancedUserData)
        advanced_user_data_container.appendChild(gaugePlot)
        
    }

    const url ="http://localhost:3000/get_data"
    httpGetAsync(url, callback)

</script>
  </body>
</html>
